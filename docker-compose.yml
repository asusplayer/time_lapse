version: '3.8'

services:
  timelapse-capture:
    build: .
    container_name: timelapse-capture
    restart: unless-stopped
    
    environment:
      # RTSP stream URL - CHANGE THIS to your stream URL
      - RTSP_URL=${RTSP_URL:-rtsp://example.com/stream}
      
      # Time to preload stream before capturing (in seconds)
      # Default: 10 seconds (usually sufficient for stable connection)
      - PRELOAD_TIME=10
      
      # Total cycle time per screenshot (in seconds)
      # Default: 60 seconds = 1 minute per cycle
      # With 60s cycle, 1 day (24h) = 1440 screenshots = ~60 seconds at 24fps
      # Note: Actual sleep time = CYCLE_TIME - PRELOAD_TIME
      - CYCLE_TIME=60
      
      # Output image resolution
      - IMAGE_WIDTH=1920
      - IMAGE_HEIGHT=1080
      
      # Output directory inside container
      - OUTPUT_DIR=/screenshots
    
    volumes:
      # Mount local directory to store screenshots
      # CHANGE THIS to your desired path
      - ./screenshots:${SCREENSHOT_PATH:-/screenshots}
    
    # Optional: If your camera is on a specific network
    # network_mode: host
    
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
